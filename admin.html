<script>
document.addEventListener('DOMContentLoaded', () => {

  const firebaseConfig = {
    // ðŸ”´ Ð¢ÐžÐ¢ Ð–Ð• CONFIG, Ð§Ð¢Ðž Ð’ vote.html
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
  const provider = new firebase.auth.GoogleAuthProvider();

  const loginBtn = document.getElementById('googleLogin');
  const resultsDiv = document.getElementById('results');

  loginBtn.addEventListener('click', () => {
    auth.signInWithPopup(provider).catch(err => {
      alert(err.message);
      console.error(err);
    });
  });

  auth.onAuthStateChanged(async user => {
    if (!user) return;

    // ðŸ” ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ ÐÐ”ÐœÐ˜ÐÐ
    if (user.email !== "Ð¢Ð’ÐžÐ¯ÐŸÐžÐ§Ð¢Ð@gmail.com") {
      alert("ÐÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°");
      auth.signOut();
      return;
    }

    loginBtn.style.display = 'none';

    const votes = await db.collection('votes').get();
    const results = {};

    votes.forEach(doc => {
      const answers = doc.data().answers;
      for (const cat in answers) {
        if (!results[cat]) results[cat] = {};
        results[cat][answers[cat]] =
          (results[cat][answers[cat]] || 0) + 1;
      }
    });

    for (const cat in results) {
      resultsDiv.innerHTML += <h3>${cat}</h3>;
      for (const name in results[cat]) {
        resultsDiv.innerHTML += <p>${name}: ${results[cat][name]}</p>;
      }
    }
  });

});
</script>
