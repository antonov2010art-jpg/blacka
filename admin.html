<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BLACK AWARDS ‚Äî –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
* {
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  background: radial-gradient(circle at center, #2b0040, #000);
  color: white;
}

#loginScreen, #adminPanel {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.login-box {
  text-align: center;
}

.google-btn {
  padding: 16px 36px;
  font-size: 18px;
  border-radius: 40px;
  border: none;
  cursor: pointer;
  background: white;
  color: black;
  font-weight: 600;
  transition: 0.3s;
}

.google-btn:hover {
  transform: scale(1.08);
}

#adminPanel {
  display: none;
  padding: 40px;
}

.panel {
  max-width: 900px;
  width: 100%;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header h1 {
  margin: 0;
}

.btn {
  padding: 10px 20px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.refresh {
  background: #9b00ff;
  color: white;
}

.logout {
  background: #444;
  color: white;
}

.category {
  margin-top: 30px;
  padding: 20px;
  background: rgba(255,255,255,0.06);
  border-radius: 16px;
}

.category h2 {
  margin-top: 0;
  border-bottom: 1px solid rgba(255,255,255,0.3);
  padding-bottom: 6px;
}

.row {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <h1>BLACK AWARDS</h1>
    <p>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</p>
    <button class="google-btn" id="loginBtn">
      –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
    </button>
  </div>
</div>

<!-- ADMIN -->
<div id="adminPanel">
  <div class="panel">
    <div class="header">
      <h1>üèÜ –ò—Ç–æ–≥–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</h1>
      <div>
        <button class="btn refresh" id="refreshBtn">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="btn logout" id="logoutBtn">–í—ã–π—Ç–∏</button>
      </div>
    </div>

    <div id="results"></div>
  </div>
</div>

<script>
/* üî¥ –í–°–¢–ê–í–¨ –°–í–û–ô firebaseConfig */
const firebaseConfig = {
  apiKey: "XXXXXXXX",
  authDomain: "XXXXXXXX.firebaseapp.com",
  projectId: "XXXXXXXX",
  appId: "XXXXXXXX"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const provider = new firebase.auth.GoogleAuthProvider();

/* üîê –¢–í–û–Ø –ü–û–ß–¢–ê –ê–î–ú–ò–ù–ê */
const ADMIN_EMAIL = "–¢–í–û–Ø–ü–û–ß–¢–ê@gmail.com";

const loginScreen = document.getElementById('loginScreen');
const adminPanel = document.getElementById('adminPanel');
const resultsDiv = document.getElementById('results');

document.getElementById('loginBtn').onclick = () => {
  auth.signInWithRedirect(provider);
};

document.getElementById('logoutBtn').onclick = () => {
  auth.signOut();
};

document.getElementById('refreshBtn').onclick = loadResults;

auth.getRedirectResult().catch(console.error);

auth.onAuthStateChanged(user => {
  if (!user) {
    loginScreen.style.display = 'flex';
    adminPanel.style.display = 'none';
    return;
  }

  if (user.email !== ADMIN_EMAIL) {
    alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞');
    auth.signOut();
    return;
  }

  loginScreen.style.display = 'none';
  adminPanel.style.display = 'block';
  loadResults();
});

async function loadResults() {
  resultsDiv.innerHTML = '';

  const snapshot = await db.collection('votes').get();
  const data = {};

  snapshot.forEach(doc => {
    const answers = doc.data().answers;
    for (const cat in answers) {
      if (!data[cat]) data[cat] = {};
      const name = answers[cat];
      data[cat][name] = (data[cat][name] || 0) + 1;
    }
  });

  for (const cat in data) {
    const block = document.createElement('div');
    block.className = 'category';
    block.innerHTML = <h2>${cat}</h2>;

    for (const name in data[cat]) {
      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = <span>${name}</span><span>${data[cat][name]}</span>;
      block.appendChild(row);
    }

    resultsDiv.appendChild(block);
  }
}
</script>

</body>
</html>
