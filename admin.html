<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>BLACK AWARDS — Админка</title>

  <!-- Firebase (ТОЧНО КАК В РАБОЧЕМ ТЕСТЕ) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .box {
      width: 700px;
      text-align: center;
    }

    button {
      padding: 16px 32px;
      font-size: 18px;
      border-radius: 30px;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    h2 {
      margin-top: 40px;
      border-bottom: 1px solid #444;
      padding-bottom: 6px;
    }

    .row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
    }
  </style>
</head>
<body>

<div class="box">
  <button id="login">Войти через Google</button>
  <div id="content"></div>
</div>

<script>
/* ========== CONFIG (ТОТ ЖЕ, ЧТО РАБОТАЛ) ========== */

const firebaseConfig = {
   apiKey: "AIzaSyAZiHeDrbP0bXx9ZsDWqGZFw_Ljh_nhBqc",
  authDomain: "black-awards.firebaseapp.com",
  projectId: "black-awards",
  storageBucket: "black-awards.firebasestorage.app",
  messagingSenderId: "1028165098992",
  appId: "1:1028165098992:web:506d988e4d97fdb062d135",
  measurementId: "G-JHFC5J81E7"
};

const ADMINS = [
  "antonov2010art@gmail.com"
];

/* ========== INIT ========== */

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const provider = new firebase.auth.GoogleAuthProvider();

const loginBtn = document.getElementById('login');
const content = document.getElementById('content');

/* ========== ВХОД — ТОЧНО КАК В ТЕСТЕ ========== */

loginBtn.onclick = () => {
  auth.signInWithPopup(provider)
    .catch(err => {
      alert(err.message);
      console.error(err);
    });
};

/* ========== АВТОРИЗАЦИЯ ========== */

auth.onAuthStateChanged(async user => {
  if (!user) return;

  if (!ADMINS.includes(user.email)) {
    alert("Нет доступа");
    auth.signOut();
    return;
  }

  loginBtn.style.display = 'none';
  content.innerHTML = <p>Админ: ${user.email}</p>;

  loadResults();
});

/* ========== ЗАГРУЗКА ГОЛОСОВ ========== */

async function loadResults() {
  const snap = await db.collection('votes').get();
  const results = {};

  snap.forEach(doc => {
    const answers = doc.data().answers  {};
    for (const cat in answers) {
      if (!results[cat]) results[cat] = {};
      const name = answers[cat];
      results[cat][name] = (results[cat][name]  0) + 1;
    }
  });

  renderResults(results);
}

/* ========== ВЫВОД ========== */

function renderResults(results) {
  for (const cat in results) {
    content.innerHTML += <h2>${cat}</h2>;

    const sorted = Object.entries(results[cat])
      .sort((a, b) => b[1] - a[1]);

    sorted.forEach(([name, count]) => {
      content.innerHTML += `
        <div class="row">
          <span>${name}</span>
          <strong>${count}</strong>
        </div>
      `;
    });
  }
}
</script>

</body>
</html>
